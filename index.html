<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsomaRapi V9 - Cantidades y Domicilio</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #fffdf2; color: #4a3c00; margin: 10px; }
        .container { max-width: 480px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .seccion { background: #fef9e7; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #ffeeba; }
        .grid-datos { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .producto { border-bottom: 1px solid #eee; padding: 12px 0; display: grid; grid-template-columns: 2fr 1fr 1fr; align-items: center; gap: 10px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        label { font-size: 0.8em; font-weight: bold; color: #856404; display: block; margin-bottom: 4px; }
        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        .btn-add { background-color: #ffcc00; font-size: 0.9em; }
        .btn-liquidar { background-color: #d4a017; color: white; margin-top: 10px; font-size: 1.1em; }
        #modal-liquidacion { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; }
        .modal-content { background: white; width: 85%; max-width: 400px; margin: 15% auto; padding: 25px; border-radius: 12px; }
        .ley { font-size: 10px; color: #777; text-align: justify; margin-top: 15px; border-top: 1px solid #eee; padding-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color:#d4a017;">üçØ AsomaRapi #<span id="label-n">1001</span></h2>

    <div class="seccion">
        <form id="form-cliente">
            <div class="grid-datos">
                <div><label>Nombre</label><input type="text" id="c-nom" required></div>
                <div><label>Celular</label><input type="text" id="c-cel" required></div>
                <div><label>Direcci√≥n</label><input type="text" id="c-dir" required></div>
                <div><label>Ciudad</label><input type="text" id="c-ciu" required></div>
                <div style="grid-column: span 2;"><label>Correo Electr√≥nico</label><input type="email" id="c-mail" required></div>
                <div style="grid-column: span 2;"><label>Valor Domicilio (COP)</label><input type="number" id="v-dom" value="5000"></div>
            </div>
            <label style="margin-top:8px;">Observaciones</label>
            <textarea id="c-obs" placeholder="Eje: Apt 302, reja blanca..."></textarea>
        </form>
    </div>

    <div class="seccion">
        <h3 style="margin-top:0;">üêù Cat√°logo de Productos</h3>
        <div id="lista-p"></div>
    </div>

    <div class="seccion">
        <h3 style="margin-top:0;">üõí Tu Pedido</h3>
        <div id="cart-box" style="font-size: 0.9em; background:white; padding:12px; border-radius:8px; border:1px solid #ddd;">El carrito est√° vac√≠o</div>
        <button class="btn btn-liquidar" onclick="revisar()">üßæ Revisar y Liquidar</button>
    </div>

    <p class="ley"><b>Protecci√≥n de Datos:</b> Ley 1581 de 2012. Sus datos se usar√°n solo para la entrega de este pedido.</p>
</div>

<div id="modal-liquidacion">
    <div class="modal-content">
        <h3>üìã Resumen Final</h3>
        <div id="resumen-final"></div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn" style="background:#eee;" onclick="cerrar()">Corregir</button>
            <button class="btn" style="background:#25d366; color:white;" onclick="enviarWA()">Enviar WhatsApp</button>
        </div>
    </div>
</div>

<script>
    const NUM_WA = "573015832244";
    let n_pedido = 1001;
    let inventario = [
        { nombre: "Miel Multiforal 500g", precio: 25000 },
        { nombre: "Polen Granulado 250g", precio: 18000 },
        { nombre: "Prop√≥leo Extracto x3", precio: 15000 }
    ];
    let carrito = [];

    function cargar() {
        const d = document.getElementById('lista-p');
        d.innerHTML = inventario.map((p, i) => `
            <div class="producto">
                <span><b>${p.nombre}</b><br>$${p.precio.toLocaleString()}</span>
                <input type="number" id="cant-${i}" value="1" min="1" style="width:50px; text-align:center;">
                <button class="btn btn-add" onclick="agregar(${i})">A√±adir</button>
            </div>`).join('');
    }

    function agregar(i) {
        const cant = parseInt(document.getElementById(`cant-${i}`).value);
        if(cant < 1) return;
        
        // Si el producto ya est√°, sumamos la cantidad
        const existe = carrito.find(item => item.nombre === inventario[i].nombre);
        if(existe) {
            existe.cant += cant;
        } else {
            carrito.push({ ...inventario[i], cant });
        }
        actualizar();
    }

    function actualizar() {
        const b = document.getElementById('cart-box');
        if(carrito.length === 0) { b.innerHTML = "El carrito est√° vac√≠o"; return; }
        b.innerHTML = carrito.map((item, idx) => 
            `<div style="margin-bottom:5px;">‚Ä¢ ${item.nombre} <b>(x${item.cant})</b> <span onclick="quitar(${idx})" style="color:red; cursor:pointer; margin-left:10px;">[x]</span></div>`
        ).join('');
    }

    function quitar(idx) {
        carrito.splice(idx, 1);
        actualizar();
    }

    function revisar() {
        if(!document.getElementById('form-cliente').checkValidity()) return alert("Socio, por favor llena todos los datos del cliente.");
        if(carrito.length === 0) return alert("El carrito est√° vac√≠o.");
        
        let subtotal = 0;
        let lista = "<ul>";
        carrito.forEach(item => {
            subtotal += (item.precio * item.cant);
            lista += `<li>${item.nombre} x${item.cant}</li>`;
        });
        const dom = parseInt(document.getElementById('v-dom').value) || 0;
        
        document.getElementById('resumen-final').innerHTML = `
            <b>PEDIDO #ASO-${n_pedido}</b><br>${lista}</ul>
            <hr>
            Subtotal: $${subtotal.toLocaleString()}<br>
            Domicilio: $${dom.toLocaleString()}<br>
            <b style="font-size:1.2em; color:#d4a017;">TOTAL: $${(subtotal+dom).toLocaleString()}</b>
        `;
        document.getElementById('modal-liquidacion').style.display = 'block';
    }

    function cerrar() { document.getElementById('modal-liquidacion').style.display = 'none'; }

    function enviarWA() {
        const n = document.getElementById('c-nom').value;
        const c = document.getElementById('c-cel').value;
        const d = document.getElementById('c-dir').value;
        const u = document.getElementById('c-ciu').value;
        const o = document.getElementById('c-obs').value;
        const domi = parseInt(document.getElementById('v-dom').value) || 0;

        let txtProd = "";
        let totalP = 0;
        carrito.forEach(item => {
            const sub = item.precio * item.cant;
            txtProd += `- ${item.nombre} x${item.cant} ($${sub.toLocaleString()})\n`;
            totalP += sub;
        });

        const fullMsg = `*ASOMARAPI - PEDIDO #ASO-${n_pedido}*\n\n` +
                        `üë§ *Cliente:* ${n}\n` +
                        `üìû *Cel:* ${c}\n` +
                        `üìç *Dir:* ${d} (${u})\n\n` +
                        `üêù *PRODUCTOS:*\n${txtProd}\n` +
                        `üõµ *Domicilio:* $${domi.toLocaleString()}\n` +
                        `üí∞ *TOTAL A PAGAR:* $${(totalP + domi).toLocaleString()}\n\n` +
                        `üìù *Obs:* ${o}\n\n` +
                        `_Acepto pol√≠tica de datos (Ley 1581)_`;

        window.open(`https://wa.me/${NUM_WA}?text=${encodeURIComponent(fullMsg)}`, '_blank');
        
        n_pedido++;
        document.getElementById('label-n').innerText = n_pedido;
        carrito = [];
        actualizar();
        cerrar();
    }

    cargar();
</script>
</body>
</html>
