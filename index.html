<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsomaRapi V7 - Final Corregida</title>
    <style>
        body { font-family: sans-serif; background-color: #fffdf2; color: #4a3c00; margin: 10px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .seccion { background: #fef9e7; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #ffeeba; }
        .grid-datos { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .producto { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; }
        .btn-add { background-color: #ffcc00; width: auto; padding: 5px 15px; }
        .btn-liquidar { background-color: #d4a017; color: white; margin-top: 10px; font-size: 1.1em; }
        #modal-liquidacion { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-content { background: white; width: 85%; max-width: 400px; margin: 20% auto; padding: 20px; border-radius: 10px; }
        .ley { font-size: 10px; color: #777; text-align: justify; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color:#d4a017;">üêù AsomaRapi #<span id="consecutivo-label">1001</span></h2>

    <div class="seccion">
        <form id="form-cliente">
            <div class="grid-datos">
                <input type="text" id="c-nombre" placeholder="Nombre" required>
                <input type="text" id="c-celular" placeholder="Celular" required>
                <input type="text" id="c-direccion" placeholder="Direcci√≥n" required>
                <input type="text" id="c-ciudad" placeholder="Ciudad" required>
                <input type="email" id="c-correo" placeholder="Email" required>
                <input type="number" id="v-domi" value="5000" title="Domicilio">
            </div>
            <textarea id="c-obs" placeholder="Observaciones..." style="margin-top:8px; height: 40px;"></textarea>
        </form>
    </div>

    <div class="seccion">
        <h3>üçØ Cat√°logo</h3>
        <div id="lista-productos">
            </div>
    </div>

    <div class="seccion">
        <h3>üõí Carrito</h3>
        <div id="carrito-ver" style="font-size: 0.9em; background:white; padding:10px; border-radius:5px; border:1px solid #ddd;">Tu carrito est√° vac√≠o</div>
        <button class="btn btn-liquidar" onclick="revisarPedido()">üßæ Liquidar Pedido</button>
    </div>

    <p class="ley">Protecci√≥n de Datos: Ley 1581 de 2012. Sus datos se usar√°n solo para este despacho.</p>
</div>

<div id="modal-liquidacion">
    <div class="modal-content">
        <h3>üìã Resumen de Venta</h3>
        <div id="resumen-final" style="font-size: 14px;"></div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn" style="background:#ccc;" onclick="cerrar()">Cerrar</button>
            <button class="btn" style="background:#25d366; color:white;" onclick="enviar()">Enviar WhatsApp</button>
        </div>
    </div>
</div>

<script>
    const WHATSAPP_NUM = "573015832244";
    let n_pedido = 1001;
    let inventario = [
        { id: 1, nombre: "Miel Multiforal 500g", precio: 25000 },
        { id: 2, nombre: "Polen Granulado 250g", precio: 18000 },
        { id: 3, nombre: "Prop√≥leo Extracto x3", precio: 15000 }
    ];
    let carrito = [];

    // Esta funci√≥n se ejecuta apenas carga la p√°gina
    function iniciar() {
        const div = document.getElementById('lista-productos');
        div.innerHTML = "";
        inventario.forEach((p, i) => {
            div.innerHTML += `
                <div class="producto">
                    <span><strong>${p.nombre}</strong><br>$${p.precio.toLocaleString()}</span>
                    <button class="btn btn-add" onclick="agregar(${i})">A√±adir</button>
                </div>`;
        });
    }

    function agregar(i) {
        carrito.push(inventario[i]);
        actualizarCarrito();
    }

    function actualizarCarrito() {
        const box = document.getElementById('carrito-ver');
        if(carrito.length === 0) { box.innerHTML = "Tu carrito est√° vac√≠o"; return; }
        box.innerHTML = carrito.map((item, idx) => 
            `<div>‚Ä¢ ${item.nombre} <span onclick="quitar(${idx})" style="color:red; cursor:pointer;">[x]</span></div>`
        ).join('');
    }

    function quitar(idx) {
        carrito.splice(idx, 1);
        actualizarCarrito();
    }

    function revisarPedido() {
        if(!document.getElementById('form-cliente').checkValidity()) return alert("Socio, llena los datos del cliente y el email.");
        if(carrito.length === 0) return alert("El carrito no tiene productos.");
        
        let suma = 0;
        let listaMsg = "<ul>";
        carrito.forEach(item => {
            suma += item.precio;
            listaMsg += `<li>${item.nombre}: $${item.precio.toLocaleString()}</li>`;
        });
        const d = parseInt(document.getElementById('v-domi').value) || 0;
        
        document.getElementById('resumen-final').innerHTML = `
            <strong>Pedido #ASO-${n_pedido}</strong>${listaMsg}
            <hr>
            Subtotal: $${suma.toLocaleString()}<br>
            Domicilio: $${d.toLocaleString()}<br>
            <strong>TOTAL: $${(suma+d).toLocaleString()}</strong>
        `;
        document.getElementById('modal-liquidacion').style.display = 'block';
    }

    function cerrar() { document.getElementById('modal-liquidacion').style.display = 'none'; }

    function enviar() {
        const nom = document.getElementById('c-nombre').value;
        const dir = document.getElementById('c-direccion').value;
        const ciu = document.getElementById('c-ciudad').value;
        const cel = document.getElementById('c-celular').value;
        const domi = document.getElementById('v-domi').value;
        const obs = document.getElementById('c-obs').value;

        let itemsTexto = "";
        let totalFinal = 0;
        carrito.forEach(item => {
            itemsTexto += `üçØ *Producto:* ${item.nombre} ($${item.precio.toLocaleString()})\n`;
            totalFinal += item.precio;
        });
        totalFinal += parseInt(domi);

        const mensaje = `*ASOMARAPI - PEDIDO #ASO-${n_pedido}*\n\n` +
                        `üë§ *Cliente:* ${nom}\n` +
                        `üìû *Cel:* ${cel}\n` +
                        `üìç *Dir:* ${dir} (${ciu})\n\n` +
                        `${itemsTexto}` +
                        `üõµ *Domicilio:* $${domi}\n` +
                        `üí∞ *TOTAL A PAGAR:* $${totalFinal.toLocaleString()}\n\n` +
                        `üìù *Obs:* ${obs}\n\n` +
                        `_Acepto pol√≠tica de datos Ley 1581_`;

        window.open(`https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent(mensaje)}`, '_blank');
        
        // Limpiar para siguiente pedido
        n_pedido++;
        document.getElementById('consecutivo-label').innerText = n_pedido;
        carrito = [];
        actualizarCarrito();
        cerrar();
    }

    iniciar(); // Forzamos el inicio del cat√°logo
</script>
</body>
</html>
